(function(){this.bbcode={}}).call(this);
(function(){var k,g,j,d,e,f,b=[].slice;e=/[&<>"]/g;d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};f=/\b((?:([\w-]+):(\/{1,3})|www[.])(?:(?:(?:[^\s&()]|&amp;|&quot;)*(?:[^!"#$%&'()*+,.:;<=>?@\[\]^`{|}~\s]))|(?:\((?:[^\s&()]|&amp;|&quot;)*\)))+)/g;g={"--":"&ndash;","---":"&mdash;","...":"&#8230;","(c)":"&copy;","(reg)":"&reg;","(tm)":"&trade;"};var a=RegExp,c;c=[];for(k in g)c.push(k.replace(/(\.|\)|\()/g,"\\$1"));j=new a(c.join("|"));k=this.bbcode;a=function(){this._contexts=[];this.options={linkify:!0}};
a.prototype.context=function(b,a){var d,c,e,f;c={};f=this.options;for(d in f)e=f[d],c[d]=e;for(d in b)e=b[d],c[d]=e;this._contexts.push(this.options);this.options=c;e=a();this.options=this._contexts.pop();return e};a.prototype.escape=function(b){return b.replace(e,function(b){return d[b]})};a.prototype.linkify=function(a){return a.replace(f,function(){var a,d,c;a=1<=arguments.length?b.call(arguments,0):[];c=a[1];if((d=a[2])&&"http"!==d&&"https"!==d)return c;a=a[1];d||(a="http://"+a);return'<a href="'+
a+'" target="_blank">'+c+"</a>"})};a.prototype.strip=function(b){return b.replace(/^\s+|\s+$/g,"")};a.prototype.cosmeticReplace=function(a){return a.replace(j,function(){var a;a=(1<=arguments.length?b.call(arguments,0):[])[0];return g[a]||a})};a.prototype.htmlAttributes=function(a){var b,d;if(a){var c;c=[];for(b in a)d=a[b],c.push(""+b+'="'+d+'"');a=c.join(" ")}else a="";return a};k.Renderer=a}).call(this);
(function(){var k,g,j,d,e,f,b,a,c,E,F,G,h,H,I,m,p,n,q,r,J=[].indexOf||function(a){for(var b=0,d=this.length;b<d;b++)if(b in this&&this[b]===a)return b;return-1},K={}.hasOwnProperty,l=function(a,b){function d(){this.constructor=a}for(var c in b)K.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype;a.prototype=new d;a.__super__=b.prototype;return a},L=this;h=/\r?\n/g;k=this.bbcode;g=function(a,b){var d,c,e,f,h;this.renderer=a;null==b&&(b={});this.CLOSED_BY=[];this.DISCARD_TEXT=this.STRIP_OUTER=this.STRIP_INNER=
this.SELF_CLOSE=!1;this.name=b.name||null;this.parent=b.parent||null;this.text=b.text||"";this.parent&&this.parent.children.push(this);null==b.params&&(b.params=[]);this.params={};h=b.params;e=0;for(f=h.length;e<f;e++)c=h[e],d=c[0],(c=c[1])&&(this.params[d]=c);this.children=[]};g.prototype.getContent=function(b){var a,d,c,e,f;null==b&&(b=!1);c=[];this.text&&(a=this.renderer.escape(this.text),b||(this.renderer.options.linkify&&(a=this.renderer.linkify(a)),a=this.renderer.cosmeticReplace(a.replace(h,
"<br />"))),c.push(a));d=this.children;e=0;for(f=d.length;e<f;e++)a=d[e],b?c.push(a.toText()):this.DISCARD_TEXT&&null===a.name||c.push(a.toHTML());c=c.join("");if(!b&&this.STRIP_INNER){for(c=this.renderer.strip(c);"<br />"===c.slice(0,6);)c=c.slice(6);for(;"<br />"===c.slice(-6);)c=c.slice(0,-6);c=this.renderer.strip(c)}return c};g.prototype.toText=function(b){var a,c,d,e;null==b&&(b=!1);c=[];if(null!==this.name)if(this.params.length){var f,h;f=this.params;h=[];for(a in f)d=f[a],h.push([a,d].join("="));
a=h.join(" ");this.name in this.params?c.push("["+a+"]"):c.push("["+this.name+" "+a+"]")}else c.push("["+this.name+"]");c.push(this.getContent(!b));null!==this.name&&(e=this.name,0>J.call(this.CLOSED_BY,e))&&c.push("[/"+this.name+"]");return c.join("")};g.prototype._toHTML=function(){return this.toText(!0)};g.prototype.toHTML=function(){var a;a=this._toHTML();return"string"===typeof a?a:a.join("")};k.Tag=g;var s=function(){s.__super__.constructor.apply(this,arguments);this.STRIP_INNER=!0;this._inline=
"inline"===this.params.code;this._inline||(this.STRIP_OUTER=!0)};l(s,this.bbcode.Tag);s.prototype._toHTML=function(){var a;return this._inline?["<code>",this.getContent(!0),"</code>"]:(a=this.params.lang||this.params[this.name])?['<pre class="prettyprint lang-'+a+'">',this.getContent(!0),"</pre>"]:["<pre>",this.getContent(!0),"</pre>"]};g=s;var t=function(){return H=t.__super__.constructor.apply(this,arguments)};l(t,this.bbcode.Tag);t.prototype._toHTML=function(){var a;a={src:this.renderer.strip(this.getContent(!0))};
"width"in this.params&&(a.width=this.params.width);"height"in this.params&&(a.height=this.params.height);return"<img "+this.renderer.htmlAttributes(a)+" />"};e=t;var u=function(){return I=u.__super__.constructor.apply(this,arguments)};l(u,this.bbcode.Tag);u.prototype._toHTML=function(){var a;a=this.params.size;return isNaN(a)?this.getContent():['<span style="font-size:'+a+'px">',this.getContent(),"</span>"]};G=u;var v=function(){return m=v.__super__.constructor.apply(this,arguments)};l(v,this.bbcode.Tag);
v.prototype._toHTML=function(){var a;a=this.params.color;return null!=a?['<span style="color:'+a+'">',this.getContent(),"</span>"]:this.getContent()};j=v;var w=function(){return p=w.__super__.constructor.apply(this,arguments)};l(w,this.bbcode.Tag);w.prototype._toHTML=function(){return['<div style="text-align:center;">',this.getContent(),"</div>"]};k=w;var x=function(){return n=x.__super__.constructor.apply(this,arguments)};l(x,this.bbcode.Tag);x.prototype._toHTML=function(){return['<div style="float:right;">',
this.getContent(),"</div>"]};F=x;var y=function(){y.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.SELF_CLOSE=!0};l(y,this.bbcode.Tag);y.prototype._toHTML=function(){return"<hr />"};d=y;var z=function(){z.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.STRIP_INNER=!0};l(z,this.bbcode.Tag);z.prototype._toHTML=function(){var a;a=this.params.list;return"1"===a?["<ol>",this.getContent(),"</ol>"]:"a"===a?['<ol style="list-style-type:lower-alpha;">',this.getContent(),
"</ol>"]:"A"===a?['<ol style="list-style-type:upper-alpha;">',this.getContent(),"</ol>"]:["<ul>",this.getContent(),"</ul>"]};a=z;var A=function(){A.__super__.constructor.apply(this,arguments);this.CLOSED_BY=["*","/list"];this.STRIP_INNER=!0};l(A,this.bbcode.Tag);A.prototype._toHTML=function(){return["<li>",this.getContent(),"</li>"]};b=A;var B=function(){B.__super__.constructor.apply(this,arguments);this.STRIP_OUTER=this.STRIP_INNER=!0};l(B,this.bbcode.Tag);B.prototype._toHTML=function(){var a,b;
b=["<blockquote>",this.getContent()];if(a=this.params.quote)b.push("<small>"),b.push(a),b.push("</small>");b.push("</blockquote>");return b};E=B;var C=function(){return q=C.__super__.constructor.apply(this,arguments)};l(C,this.bbcode.Tag);C.prototype._toHTML=function(){var a,b=this;a=this.renderer.strip(this.params[this.name]||this.getContent(!0));/javascript:/i.test(a)?a="":/:/.test(a)||(a="http://"+a);return a?this.renderer.context({linkify:!1},function(){return['<a href="'+a+'" target="_blank">',
b.getContent(),"</a>"]}):this.getContent()};f=C;var D=function(){return r=D.__super__.constructor.apply(this,arguments)};l(D,this.bbcode.Tag);D.prototype._toHTML=function(){return'<span style="text-decoration: overline;">'+this.getContent(!0)+"</span>"};c=D;this.bbcode.createSimpleTag=function(a,b){var c=function(){var a,d;c.__super__.constructor.apply(this,arguments);for(a in b)d=b[a],this[a]=d};l(c,L.bbcode.Tag);c.prototype._toHTML=function(){var b;(b=this.renderer.htmlAttributes(this.params))&&
(b=" "+b);return["<"+a+b+">",this.getContent(),"</"+a+">"]};return c};this.bbcode.BUILTIN={b:this.bbcode.createSimpleTag("strong"),i:this.bbcode.createSimpleTag("em"),u:this.bbcode.createSimpleTag("u"),s:this.bbcode.createSimpleTag("strike"),h1:this.bbcode.createSimpleTag("h1",{STRIP_OUTER:!0}),h2:this.bbcode.createSimpleTag("h2",{STRIP_OUTER:!0}),h3:this.bbcode.createSimpleTag("h3",{STRIP_OUTER:!0}),h4:this.bbcode.createSimpleTag("h4",{STRIP_OUTER:!0}),h5:this.bbcode.createSimpleTag("h5",{STRIP_OUTER:!0}),
h6:this.bbcode.createSimpleTag("h6",{STRIP_OUTER:!0}),pre:this.bbcode.createSimpleTag("pre"),table:this.bbcode.createSimpleTag("table",{DISCARD_TEXT:!0}),thead:this.bbcode.createSimpleTag("thead",{DISCARD_TEXT:!0}),tbody:this.bbcode.createSimpleTag("tbody",{DISCARD_TEXT:!0}),tr:this.bbcode.createSimpleTag("tr",{DISCARD_TEXT:!0}),th:this.bbcode.createSimpleTag("th"),td:this.bbcode.createSimpleTag("td"),sup:this.bbcode.createSimpleTag("sup"),sub:this.bbcode.createSimpleTag("sub"),code:g,img:e,hr:d,
size:G,center:k,right:F,color:j,list:a,"*":b,quote:E,url:f,link:f,o:c}}).call(this);
(function(){var k,g,j,d=[].indexOf||function(b){for(var a=0,c=this.length;a<c;a++)if(a in this&&this[a]===b)return a;return-1};k=/^\s*$/;j=/(\[\/?.+?\])/;g=/^\r?\n/;var e=this.bbcode,f=function(b){var a,c,e;null==b&&(b=null);this.tags={};if(b){c=0;for(e=b.length;c<e;c++)a=b[c],0<=d.call(bbcode.BUILTIN,a)&&this.registerTag(a,bbcode.BUILTIN[a])}else for(a in c=bbcode.BUILTIN,c)b=c[a],this.registerTag(a,b);this.renderer=new bbcode.Renderer};f.prototype.registerTag=function(b,a){return this.tags[b]=a};
f.prototype._parseParams=function(b){var a,c,d,e,f,h,g,j,m;d=[];if(b){f=c=[];g=[];h=" ";e=!1;j=0;for(m=b.length;j<m;j++)a=b[j],e?e=!1:f===c&&"="===a?f=g:!g.length&&'"'===a?h=a:a!==h?f.push(a):(d.push([c.join("").toLowerCase(),g.join("")]),k.test(h)||(e=!0),f=c=[],g=[],h=" ");d.push([c.join("").toLowerCase(),g.join("")])}return d};f.prototype._createTextNode=function(b,a){var c;if(null!=(c=b.children.slice(-1)[0])&&c.STRIP_OUTER)a=a.replace(g,"");return new bbcode.Tag(this.renderer,{text:a,parent:b})};
f.prototype.parse=function(b){var a,c,e,f,g,h;c=f=new bbcode.Tag(this.renderer);for(h=b.split(j);h.length;)if(g=h.shift(),g.match(j))if(e=this._parseParams(g.slice(1,-1)),b=e[0][0],0<=d.call(c.CLOSED_BY,b)&&(h.unshift(g),b="/"+c.name,e=[]),"/"===b[0])b=b.slice(1),b in this.tags?c.name===b&&(c=c.parent):this._createTextNode(c,g);else if(a=this.tags[b]){if(a=new a(this.renderer,{name:b,parent:c,params:e}),!a.SELF_CLOSE&&(0>d.call(a.CLOSED_BY,b)||c.name!==b))c=a}else this._createTextNode(c,g);else this._createTextNode(c,
g);return f};f.prototype.toHTML=function(b){return this.parse(b).toHTML()};e.Parser=f}).call(this);
(function(){var k;k={bold:{keyCode:66,title:"Bold (Ctrl+B)",placeholder:"bold text",open:"[b]",close:"[/b]"},italic:{keyCode:73,title:"Italic (Ctrl+I)",placeholder:"italic text",open:"[i]",close:"[/i]"},center:{keyCode:69,title:"Center (Ctrl+E)",placeholder:"center text",open:"[center]",close:"[/center]"},hyperlink:{keyCode:76,title:"Hyperlink (Ctrl+L)",placeholder:"link text",open:function(){return"[url="+(prompt("Please enter the URL of your link","http://")||"link url")+"]"},close:"[/url]"},blockquote:{keyCode:190,
title:"Blockquote (Ctrl+.)",placeholder:"blockquote",open:"[quote]",close:"[/quote]"},code:{keyCode:76,title:"Code (Ctrl+K)",placeholder:'print("code sample");',open:"[code]",close:"[/code]"},image:{keyCode:71,placeholder:"image url",open:"[img]",close:"[/img]"},nlist:{keyCode:79,title:"Numbered List (Ctrl+O)",placeholder:"list item",open:function(d){var e,f,b;e=(null!=(f=d.match(/\[list=1\]/g))?f.length:void 0)||0;d=(null!=(b=d.match(/\[\/list\]/g))?b.length:void 0)||0;return e===d?"[list=1]\n\t[*]":
"\t[*]"},close:function(d){var e,f,b;e=(null!=(f=d.match(/\[list=1\]/g))?f.length:void 0)||0;d=(null!=(b=d.match(/\[\/list\]/g))?b.length:void 0)||0;if(e===d)return"\n[/list]"}},list:{keyCode:85,title:"Bulleted List (Ctrl+O)",placeholder:"list item",open:function(d){var e,f,b;e=(null!=(f=d.match(/\[list\]/g))?f.length:void 0)||0;d=(null!=(b=d.match(/\[\/list\]/g))?b.length:void 0)||0;return e===d?"[list]\n\t[*]":"\t[*]"},close:function(d){var e,f,b;e=(null!=(f=d.match(/\[list\]/g))?f.length:void 0)||
0;d=(null!=(b=d.match(/\[\/list\]/g))?b.length:void 0)||0;if(e===d)return"\n[/list]"}},heading:{keyCode:72,title:"Heading (Ctrl+H)",placeholder:"heading",open:"[h3]",close:"[/h3]",before:/\n$/,after:/^\n/},hrule:{keyCode:82,title:"Hprizontal Rule (Ctrl+R)",open:"[hr]\n",before:/\n\n$/,after:/^\n\n/}};var g=this.bbcode,j=function(d,e){var f=this;this.markup=null!=e?e:k;this.$=$(d);this.textarea=this.$[0];this.$.on("keydown",function(b){var a,c,d,e,g,h,j,k,m,p,n,q,r;if(9===b.which){h=f.getSelection();
g=0;if(h.start===h.end&&!b.shiftKey)g++,h.value[1]="\t"+h.value[1],f.setValue(h.value.join(""));else{c=0;k=!1;e=[];n=f.textarea.value.split("\n");m=0;for(p=n.length;m<p;m++){d=n[m];a=[c,c+=d.length+1];j=a[0];a=a[1];if(!k&&j<=(q=h.start)&&q<a)k=!0;k&&(b.shiftKey?"\t"===d[0]&&(d=d.slice(1),g--):(d="\t"+d,g++),k=!(j<=(r=h.end)&&r<=a));e.push(d)}f.setValue(e.join("\n"))}0<g?h.start++:0>g&&h.start--;f.select(h.start,h.end+g)}else{if(!b.ctrlKey||null==f.getRule(b.which))return!0;f.replace(b.which)}return!1})};
j.prototype._escapeRe=function(d){d=d.replace(RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\^|\\$)","g"),"\\$1");return RegExp("^"+d.replace(/\d+/,"\\d+")+"$")};j.prototype.getRule=function(d){var e,f,b;b=this.markup;for(e in b)if(f=b[e],f.keyCode===d)return f};j.prototype.replace=function(d,e,f){var b,a,c;this.$.focus();c=this.getSelection();a=this.getRule(d);e=this.textarea.value;b=("function"===typeof a.open?a.open(c.value[0]):a.open)||"";d=("function"===typeof a.close?a.close(c.value[2]):
a.close)||"";if(this._escapeRe(b).test(e.slice(c.start-b.length,c.start))&&this._escapeRe(d).test(e.slice(c.end,c.end+d.length)))return f=c.start-b.length,this.setValue(e.substr(0,f)+c.value[1]+e.substr(c.end+d.length,e.length)),this.select(f,f+c.value[1].length);e=b+(f||c.value[1]||a.placeholder||"")+d;null!=a.before&&!a.before.test(c.value[0])&&(e="\n\n"+e,c.start+=2);null!=a.after&&!a.after.test(c.value[2])&&(e+="\n\n",c.end+=2);this.setValue(c.value[0]+e+c.value[2]);return this.select(c.start+
b.length,c.start+e.length-d.length)};j.prototype.setValue=function(d){var e;e=this.$.scrollTop();this.$.val(d);return this.$.scrollTop(e)};j.prototype.select=function(d,e){var f;if(null!=(null!=(f=document.selection)?f.createRange:void 0))return f=this.textarea.createTextRange(),f.collapse(!0),f.moveStart("character",d),f.moveEnd("character",e-d),f.select();this.textarea.selectionStart=d;return this.textarea.selectionEnd=e};j.prototype.getSelection=function(){var d,e,f,b,a;a=this.textarea.value;null!=
(null!=(b=document.selection)?b.createRange:void 0)?(e=document.selection,/testarea/i.test(this.textarea.tagName)?(d=e.createRange(),b=d.duplicate(),b.moveToElementText(this.textarea),b.setEndPoint("EndToEnd",d),b=b.text.length-d.text.length,e=b+d.text.length):(d=e.createRange().duplicate(),d.moveEnd("character",a.length),b=""===d.text?a.length:a.lastIndexOf(d.text),d=e.createRange().duplicate(),d.moveStart("character",-a.length),e=d.text.length+1)):(b=this.textarea.selectionStart,e=this.textarea.selectionEnd);
f=a.substring(0,b);d=a.substring(e,a.length);return{start:b,end:e,value:[f,a.substring(b,e),d]}};g.Editor=j}).call(this);
